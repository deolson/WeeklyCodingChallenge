DROP TABLE IF EXISTS Bonus;
DROP TABLE IF EXISTS Workers;


CREATE TABLE Workers (
	WORKER_ID serial PRIMARY KEY,
	FIRST_NAME varchar(20) NOT NULL,
	LAST_NAME varchar(20) NOT NULL,
	SALARY NUMERIC CHECK (SALARY > 0),
	JOINING_DATE Timestamp NOT NULL,
	DEPARTMENT varchar(20)
);

CREATE TABLE Bonus (
	BONUS_ID serial PRIMARY KEY,
	WORKER_REF_ID INT NOT NULL,
	BONUS_DATE Timestamp NOT NULL,
	BONUS_AMOUNT INT NOT NULL,
	FOREIGN KEY (WORKER_REF_ID) REFERENCES Workers (WORKER_ID) ON DELETE CASCADE
);

INSERT INTO Workers VALUES (1,'Rick','Smith',100000,'2021-02-20 09:00:00','HR');
INSERT INTO Workers VALUES (2,'Sam','Williams',80000,'2021-06-11 09:00:00','Admin');
INSERT INTO Workers VALUES (3,'John','Brown',300000,'2021-02-20 09:00:00','HR');
INSERT INTO Workers VALUES (4,'Amy','Jones',500000,'2021-02-20 09:00:00','Admin');
INSERT INTO Workers VALUES (5,'Sean','Garcia',500000,'2021-06-11 09:00:00','Admin');
INSERT INTO Workers VALUES (6,'Ryan','Miller',200000,'2021-06-11 09:00:00','Account');
INSERT INTO Workers VALUES (7,'Patty','Davis',75000,'2021-01-20 09:00:00','Account');
INSERT INTO Workers VALUES (8,'Monica','Rodriguez',90000,'2021-04-11 09:00:00','Admin');

INSERT INTO BONUS (WORKER_REF_ID,BONUS_DATE,BONUS_AMOUNT) VALUES (1,'2021-02-20 00:00:00',5000);
INSERT INTO BONUS (WORKER_REF_ID,BONUS_DATE,BONUS_AMOUNT) VALUES (2,'2021-06-11 00:00:00',3000);
INSERT INTO BONUS (WORKER_REF_ID,BONUS_DATE,BONUS_AMOUNT) VALUES (3,'2021-02-20 00:00:00',4000);
INSERT INTO BONUS (WORKER_REF_ID,BONUS_DATE,BONUS_AMOUNT) VALUES (1,'2021-02-20 00:00:00',4500);
INSERT INTO BONUS (WORKER_REF_ID,BONUS_DATE,BONUS_AMOUNT) VALUES (2,'2021-06-11 00:00:00',3500);

SELECT FIRST_NAME,LAST_NAME FROM Workers WHERE SALARY BETWEEN 50000 AND 100000;
SELECT DEPARTMENT, COUNT (WORKER_ID) FROM Workers GROUP BY DEPARTMENT ORDER BY DEPARTMENT DESC;
SELECT * FROM Workers INNER JOIN Bonus ON WORKER_ID = WORKER_REF_ID;

SELECT SALARY FROM (
	SELECT 
		SALARY, 
		DENSE_RANK () OVER (
			ORDER BY SALARY DESC
		) RANK
	FROM Workers
	) AS ranked
WHERE RANK = 3;
	



